# 雪花算法

## 简介
是由64位整数组成的分布式ID，并且能在单机上递增

## 分配原则（默认情况）
1bit:符号位，固定是0

41bit：时间戳，采用当前系统的具体时间，单位毫秒

10bit：工作机器ID

12bit：序列号，自增域，表示在同一毫秒下，这个自增域最大可以分配的bit个数（产生多少个id）

## 存在问题
### 时间回拨
本地时钟可能会因为各种原因发生各种不准的情况，网络中提供了ntp服务来做时间校准。时间回拨就是服务器因为时间同步，而导致本机的时间回拨。会导致数据重复。

**可用的解决方法：** 重新规划雪花算法的64位，比如减少工作机器位，预留几位扩展位，将当前时间与上一次的时间进行比较，如果小于就说明发生了回拨。如果时间差较短（5ms），那么可以直接等待一定时间，让机器的时间追上来。如果时间差较大。我们可以直接在扩展位+1，。

## 为什么需要雪花算法
如果ID采用数据库的自增主键，在分布式系统中需要分库分表，会有两个相同的表，有可能产生主键冲突。
